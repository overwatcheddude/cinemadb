<!DOCTYPE html>
<html>
    <head>
        <title>
            Database Interface
        </title>
		<script>
            function responseHandling()
            {				
                //Used for debugging
                console.log(this.responseText);

                //Convert responseText to a JS object
                let jsonArray = JSON.parse(this.responseText);

                //Read items from the webpage.
                let divItems = document.getElementById("divItems");
                let countItems = document.getElementById("countItems");

                //Write the items count into countItems div.
                countItems.innerHTML = jsonArray.length + " movies have been found in the database.";
				divItems.innerHTML = "";
				
				//For every item in the jsonArray.
                for (let item of jsonArray)
                {
					//Create a paragraph.
                    let table = document.createElement("TABLE");
					
					//Insert name key to itemString.
                    let itemString = item.name + " " + item.genre + " " + item.rating + " " + item.language;
                    let pText = document.createTextNode(itemString);
                    table.innerHTML += itemString + " <a href='#' onclick='deleteMovie(\"" + item.name + "\");'>Remove</a>";
                    divItems.appendChild(table);
                }
            }
			
			//XMLHttpRequest for GET.
			let httpRequest = new XMLHttpRequest();
			httpRequest.addEventListener("load", responseHandling);
			httpRequest.open("GET", "http://cinemadb.eu-4.evennode.com/");
			httpRequest.send();
			
			function deleteMovie(name)
			{
				let httpRequest = new XMLHttpRequest();
				httpRequest.open("DELETE", "http://cinemadb.eu-4.evennode.com/deletemovie/" + name);
				httpRequest.send();
			}
			
			function updateMovie()
			{
				var name = document.getElementById("name").value;
				var newName = document.getElementById("newName").value;
				let httpRequest = new XMLHttpRequest();
				httpRequest.open("PUT", "http://cinemadb.eu-4.evennode.com/updatemovie/" + name + "/" + newName);
				httpRequest.send();
				return false;
			}
		</script>
		<!--Bootstrap code-->
		  <meta name="viewport" content="width=device-width, initial-scale=1">
		  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    </head>
    <body>
	<h1>
		Database Interface
	</h1>
	<table>
		<tr>
			<th>
				Name
			</th>
			<th>
				Genre
			</th>
			<th>
				Rating
			</th>
			<th>
				Language
			</th>
		</tr>
	</table>
        <div id="divItems"></div>
		<div id="countItems" style="text-decoration: underline"></div>
<table style="border-style: solid; border-width: 1px; background-color: #eee">
	<tr>
		<td>
			<form method="post" action="http://cinemadb.eu-4.evennode.com/addmovie" onsubmit="location.reload();">
				<label>Add your movie.</label><br>
				<input type="text" name="name" placeholder="Type the movie name here." required>
				<input type="text" name="genre" placeholder="Insert genre here." required>
				<input type="text" name="rating" placeholder="Insert rating here." required>
				<input type="text" name="language" placeholder="Insert language here." required>
				<input type="submit"></input>
			</form>
		</td>
	</tr>
	<tr>
		<td>
			<form method="post" action="http://cinemadb.eu-4.evennode.com/updatemovie" onsubmit="return updateMovie();">
				<label>Update your movie.</label><br>
				<input type="text" id="name" placeholder="Type old movie name here." required>
				<input type="text" id="newName" placeholder="Type new movie name here." required>
				<input type="submit"></input>
			</form>
		</td>
	</tr>
</table>
    </body>
</html>