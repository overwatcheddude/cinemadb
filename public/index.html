<!DOCTYPE html>
<html>
    <head>
        <title>
            Database Interface
        </title>
		<script>
            function responseHandling()
            {				
                //Used for debugging
                console.log(this.responseText);

                //Convert responseText to a JS object
                let jsonArray = JSON.parse(this.responseText);

                //Read items from the webpage.
                let divItems = document.getElementById("divItems");
                let countItems = document.getElementById("countItems");

                //Write the items count into countItems div.
                countItems.innerHTML = "We have found " + jsonArray.length + " items.";
				divItems.innerHTML = "";
				
                for (let item of jsonArray)
                {
                    let p = document.createElement("p");
					
                    let itemString = item.name;
                    let pText = document.createTextNode(itemString);
                    p.innerHTML += itemString + " <a href='#' onclick='deleteMovie(\"" + item.name + "\");'>x</a>";
                    divItems.appendChild(p);
                }
            }

			let httpRequest = new XMLHttpRequest();
			httpRequest.addEventListener("load", responseHandling);
			httpRequest.open("GET", "http://localhost:7878/");
			httpRequest.send();
			
			function deleteMovie(name)
			{
				let httpRequest = new XMLHttpRequest();
				httpRequest.open("DELETE", "http://localhost:7878/deletemovie/" + name);
				httpRequest.send();
			}
			
			function updateMovie()
			{
				var name = document.getElementById("name").value;
				var newName = document.getElementById("newName").value;
				let httpRequest = new XMLHttpRequest();
				httpRequest.open("PUT", "http://localhost:7878/updatemovie/" + name + "/" + newName);
				httpRequest.send();
				return false;
			}
        </script>
    </head>
    <body>
	<h1>
		Database Interface
	</h1>
        <div id="countItems"></div>
        <div id="divItems"></div>

<table style="border-style: solid; border-width: 1px; background-color: #eee">
	<tr>
		<td>
			<form method="post" action="http://localhost:7878/addmovie" onsubmit="location.reload();">
				<label>Add your movie.</label><br>
				<input type="text" name="name" placeholder="Type the movie name here." required>
				<input type="text" name="genre" placeholder="Insert genre here." required>
				<input type="submit"></input>
			</form>
		</td>
	</tr>
	<tr>
		<td>
			<form method="post" action="http://localhost:7878/updatemovie" onsubmit="return updateMovie();">
				<label>Update your movie.</label><br>
				<input type="text" id="name" placeholder="Type old movie name here." required>
				<input type="text" id="newName" placeholder="Type new movie name here." required>
				<input type="submit"></input>
			</form>
		</td>
	</tr>
</table>
    </body>
</html>